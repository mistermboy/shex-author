{"ast":null,"code":"import _slicedToArray from \"/home/mistermboy/repositories/shex-author/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/mistermboy/repositories/shex-author/src/components/EditorComp.js\";\nimport React, { useState, useContext, useEffect, useRef } from 'react';\nimport 'yashe/dist/yashe.min.css';\nimport { ShapesContext } from '../App';\nimport YASHE from 'yashe';\nimport Editor from '../entities/editor';\nimport yasheUtils from '../utils/yasheUtils';\n\nfunction EditorComp() {\n  const _useState = useState(null),\n        _useState2 = _slicedToArray(_useState, 2),\n        yashe = _useState2[0],\n        setYashe = _useState2[1];\n\n  const divRef = useRef(null);\n  const context = useContext(ShapesContext);\n  const darkStyle = {\n    background: '#2B2B2B'\n  };\n  const lightStyle = {\n    background: 'white'\n  };\n\n  const _useState3 = useState(lightStyle),\n        _useState4 = _slicedToArray(_useState3, 2),\n        style = _useState4[0],\n        setStyle = _useState4[1];\n\n  let theme = 'light';\n  useEffect(() => {\n    if (!yashe) {\n      const options = {\n        persistent: false,\n        lineNumbers: true,\n        viewportMargin: Infinity,\n        value: yasheUtils.DEFAULT_SHAPE\n      };\n      const y = YASHE(divRef.current, options);\n      y.on('blur', function () {\n        if (!y.hasErrors(y)) {\n          replaceShapes();\n          updatePrefixes();\n        }\n      });\n      y.on('humanEvent', function (shapes) {\n        Editor.getInstance().draw(shapes);\n      });\n      y.on('prefixUpdate', function () {\n        updatePrefixes();\n      });\n      y.on('themeChange', function () {\n        changeThemeStyle();\n      });\n      y.on('delete', function () {\n        replaceShapes();\n        updatePrefixes();\n      });\n      y.on('upload', function () {\n        //TimeOut necesary\n        setTimeout(function () {\n          replaceShapes();\n          updatePrefixes();\n        }, 10);\n      });\n      /*\n                  y.on('keydown', function() {\n                      if(!y.hasErrors()){\n                          replaceShapes();\n                          updatePrefixes();\n                      }\n                  });\n      \n                  */\n      //Fired after a key is handled through a key map\n      //(for example \"Ctrl-Z\")\n\n      y.on('keyHandled', function () {\n        if (!y.hasErrors()) {\n          replaceShapes();\n          updatePrefixes();\n        }\n      });\n      y.refresh();\n      setYashe(y);\n      Editor.getInstance().setYashe(y);\n      replaceShapes();\n      updatePrefixes();\n    }\n  }, [yashe]);\n\n  const replaceShapes = () => {\n    context.replaceShapes(yasheUtils.replaceShapes());\n  };\n\n  const updatePrefixes = () => {\n    context.updatePrefixes(yasheUtils.updatePrefixes());\n  };\n\n  const changeThemeStyle = () => {\n    if (theme == 'light') {\n      //I don't know why this doesn't work with style state\n      setStyle(darkStyle);\n      theme = 'dark';\n    } else {\n      theme = 'light';\n      setStyle(lightStyle);\n    }\n\n    context.changeThemeStyle();\n  };\n\n  return React.createElement(\"div\", {\n    className: \"col edit\",\n    ref: divRef,\n    style: style,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134\n    },\n    __self: this\n  });\n}\n\nexport default EditorComp;","map":{"version":3,"sources":["/home/mistermboy/repositories/shex-author/src/components/EditorComp.js"],"names":["React","useState","useContext","useEffect","useRef","ShapesContext","YASHE","Editor","yasheUtils","EditorComp","yashe","setYashe","divRef","context","darkStyle","background","lightStyle","style","setStyle","theme","options","persistent","lineNumbers","viewportMargin","Infinity","value","DEFAULT_SHAPE","y","current","on","hasErrors","replaceShapes","updatePrefixes","shapes","getInstance","draw","changeThemeStyle","setTimeout","refresh"],"mappings":"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","sourcesContent":["import React, {useState,useContext,useEffect,useRef} from 'react';\nimport 'yashe/dist/yashe.min.css';\nimport {ShapesContext} from '../App';\n\nimport YASHE from 'yashe';\nimport Editor from '../entities/editor';\n\nimport yasheUtils from '../utils/yasheUtils';\n\nfunction EditorComp() {\n\n  const [yashe,setYashe] = useState(null);\n  const divRef = useRef(null);\n  const context = useContext(ShapesContext);\n\n   const darkStyle = {\n        background: '#2B2B2B',\n    }\n\n    const lightStyle = {\n        background: 'white',\n    }\n\n    const [style,setStyle] = useState(lightStyle);\n    let theme = 'light';\n\n\n    useEffect(() => {\n    \n        if (!yashe) {\n            const options = {\n                persistent:false,\n                lineNumbers: true,\n                viewportMargin: Infinity,\n                value:yasheUtils.DEFAULT_SHAPE\n            }\n            \n            const y = YASHE(\n                divRef.current, \n                options)\n\n             y.on('blur', function() {\n                if(!y.hasErrors(y)){\n                    replaceShapes();\n                    updatePrefixes();\n                }\n            });\n\n\n             \n            y.on('humanEvent', function(shapes) {\n                Editor.getInstance().draw(shapes);\n            });\n\n\n            y.on('prefixUpdate', function() {\n                updatePrefixes();\n            });\n\n            y.on('themeChange', function() {\n                changeThemeStyle();\n            });\n\n            y.on('delete', function() {\n                replaceShapes();\n                updatePrefixes();\n\n            });\n\n            y.on('upload', function() {\n                //TimeOut necesary\n                setTimeout(function(){\n                  replaceShapes();\n                  updatePrefixes();\n                }, 10);\n                \n            });\n\n/*\n            y.on('keydown', function() {\n                if(!y.hasErrors()){\n                    replaceShapes();\n                    updatePrefixes();\n                }\n            });\n\n            */\n           \n\n            //Fired after a key is handled through a key map\n            //(for example \"Ctrl-Z\")\n            y.on('keyHandled', function() {\n                if(!y.hasErrors()){\n                    replaceShapes();\n                    updatePrefixes();\n                }\n            });\n\n            \n            y.refresh();\n            setYashe(y);\n            \n            Editor.getInstance().setYashe(y);\n\n            replaceShapes();\n            updatePrefixes();\n\n            \n        }\n    }, [yashe]\n    );\n\n    const replaceShapes = ()=>{\n        context.replaceShapes(yasheUtils.replaceShapes());\n    }\n\n    const updatePrefixes = ()=>{\n        context.updatePrefixes(yasheUtils.updatePrefixes());\n    }\n\n     const changeThemeStyle = ()=>{\n        if(theme=='light'){//I don't know why this doesn't work with style state\n            setStyle(darkStyle);\n            theme='dark';\n        }else{\n            theme='light';\n            setStyle(lightStyle);\n        }\n        context.changeThemeStyle();\n    }\n\n\n\n    return  (<div className=\"col edit\" ref={divRef} style={style}/>);\n\n}\n\n\n\nexport default EditorComp;\n\n"]},"metadata":{},"sourceType":"module"}