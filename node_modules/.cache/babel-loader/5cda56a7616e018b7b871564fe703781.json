{"ast":null,"code":"\"use strict\";\n\nvar $ = require(\"jquery\"),\n    rdfUtils = require('./rdfUtils.js');\n/**\n * Write our own tooltip, to avoid loading another library for just this functionality. For now, we only use tooltip for showing parse errors, so this is quite a tailored solution\n * Requirements:\n * \t\tposition tooltip within codemirror frame as much as possible, to avoid z-index issues with external things on page\n * \t\tuse html as content\n */\n\n\nvar grammarTootlip = function grammarTootlip(yashe, parent, html) {\n  var parent = $(parent);\n  var tooltip;\n  parent.hover(function () {\n    if (typeof html == \"function\") html = html();\n    tooltip = $(\"<div>\").addClass(\"yashe_tooltip\").html(html).appendTo(parent);\n    repositionTooltip();\n  }, function () {\n    $(\".yashe_tooltip\").remove();\n  });\n  /**\n  * only need to take into account top and bottom offset for this usecase\n  */\n\n  var repositionTooltip = function repositionTooltip() {\n    if ($(yashe.getWrapperElement()).offset().top >= tooltip.offset().top) {\n      //shit, move the tooltip down. The tooltip now hovers over the top edge of the yashe instance\n      tooltip.css(\"bottom\", \"auto\");\n      tooltip.css(\"top\", \"26px\");\n    }\n  };\n};\n/**\n * \n * WIKIDATA Tooltip for properties and entities\n * \n */\n\n\nvar triggerTooltip = function triggerTooltip(yashe, e) {\n  var posX = e.clientX,\n      posY = e.clientY + $(window).scrollTop();\n  var token = yashe.getTokenAt(yashe.coordsChar({\n    left: posX,\n    top: posY\n  })).string;\n  var prefixName = token.split(':')[0];\n  var wikiElement = token.split(':')[1]; //Check wikidata prefixes\n\n  if (rdfUtils.isWikidataValidPrefix(yashe, prefixName) && wikiElement !== undefined && wikiElement !== '') {\n    checkEntity(wikiElement).done(function (data) {\n      if (!data.error) {\n        var userLang, entity, description, theme; //Gets the preference languaje from the navigator\n\n        userLang = (navigator.language || navigator.userLanguage).split(\"-\")[0];\n        var content = data.entities[wikiElement.toUpperCase()]; //Check if the property/entity exist\n\n        if (!content.labels) return; //Some properties and entities are only avalible in English\n        //So if they do not exist we take it in English\n\n        if (content.labels[userLang] && content.descriptions[userLang]) {\n          entity = content.labels[userLang].value + ' (' + wikiElement + ')';\n          description = content.descriptions[userLang].value;\n        } else {\n          entity = content.labels['en'].value + ' (' + wikiElement + ')';\n          description = content.descriptions['en'].value;\n        }\n\n        if (yashe.getOption('theme') != 'dark') theme = {\n          'background': '#fff',\n          'color': '#000',\n          'border-style': 'solid',\n          'border-width': '1px',\n          'border-color': '#70dbe9',\n          'border-radius': '10px',\n          'padding': '1px',\n          'line-height': '15px',\n          'text-align': 'center'\n        };else theme = {\n          'background': '#000',\n          'color': '#fff',\n          'border-style': 'solid',\n          'border-width': '1px',\n          'border-color': '#70dbe9',\n          'border-radius': '10px',\n          'padding': '1px',\n          'line-height': '15px',\n          'text-align': 'center'\n        };\n        $('<div class=\"CodeMirror cm-s-default CodeMirror-wrap\">').css('position', 'absolute').css('z-index', '100').css('max-width', '200px').css({\n          top: posY + 2,\n          left: posX + 2\n        }).addClass('wikibaseRDFtoolTip').html(\"<div class='wikidata_tooltip'>\" + entity + \" <br><br>\" + description + \"</div>\").css(theme).css('z-index', 1200).appendTo('body');\n      }\n    });\n  }\n\n  ;\n}; //  U S A R         M  É  T  O  D  O    P  Á  R  A  M  S\n\n\nvar checkEntity = function checkEntity(entity) {\n  return $.get({\n    url: 'https://www.wikidata.org/w/api.php?action=wbgetentities&format=json&ids=' + entity,\n    dataType: 'jsonp'\n  });\n};\n\nvar removeWikiToolTip = function removeWikiToolTip() {\n  $('.wikibaseRDFtoolTip').remove();\n};\n/**\n   * Returns a function, that, as long as it continues to be invoked, will not\n   * be triggered. The function will be called after it stops being called for\n   * N milliseconds. If `immediate` is passed, trigger the function on the\n   * leading edge, instead of the trailing.\n   *\n   * More info: https://davidwalsh.name/javascript-debounce-function\n   *\n * @param {funciton} func Function to be executed\n * @param {int} wait Time to wait\n * @param {boolean} immediate\n * @return {object} resutl\n */\n\n\nvar debounce = function debounce(func, wait, immediate) {\n  var timeout;\n  var result;\n  return function () {\n    var context = this;\n    var args = arguments;\n\n    var later = function later() {\n      timeout = null;\n      if (!immediate) result = func.apply(context, args);\n    };\n\n    var callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) result = func.apply(context, args);\n    return result;\n  };\n};\n\nmodule.exports = {\n  grammarTootlip: grammarTootlip,\n  triggerTooltip: triggerTooltip,\n  removeWikiToolTip: removeWikiToolTip,\n  debounce: debounce\n};","map":null,"metadata":{},"sourceType":"script"}